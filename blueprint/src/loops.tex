\chapter{Loops}
\label{chap:loops}

\section{Introduction}
\label{sec:loops_introduction}

In this chapter, we explain how to construct families of loops to feed into the
corrugation process explained at the end of the introduction.
A loop is a map defined on the circle $ùïä^1 = ‚Ñù/‚Ñ§$.
It can also freely be seen as $1$-periodic maps defined on $‚Ñù$.

\begin{definition}
  \label{def:average}
  \lean{loop.average}
  \leanok
  The average of a loop $Œ≥$ is $\bar Œ≥ := \int_{ùïä^1} Œ≥(s)\, ds$.
\end{definition}

Throughout this document, $E$ and $F$ will denote finite-dimensional
real vector spaces.
All of this chapter is devoted to proving the following proposition.

\begin{proposition}
  \label{prop:loops}
  \uses{def:average}
  \lean{exists_loops}
  \leanok
  Let $U$ be an open set in $E$ and $K ‚äÜ U$ a compact subset.
  Let $Œ©$ be a set in $E √ó F$ such that, for each $x$ in $U$,
  $Œ©_x := Œ© ‚à© (\{x\} √ó F)$ is open and connected.

  Let $Œ≤$ and $g$ be maps from $E$ to $F$ that are smooth on $U$.
  Assume that $Œ≤(x) ‚àà Œ©_x$ for all $x$ in $U$,
  and $g(x) = Œ≤(x)$ near $K$.

  If, for every $x$ in $U$, $g(x)$ is in the convex hull of $Œ©_x$, then there
  exists a smooth family of loops
  \[
    Œ≥ \co E √ó [0, 1] √ó ùïä^1 ‚Üí F, (x, t, s) ‚Ü¶ Œ≥^t_x(s)
  \]
  such that, for all $x$ in $U$, and all $(t, s) ‚àà [0, 1] √ó ùïä^1$
  \begin{itemize}
    \item
      $Œ≥^t_x(s) ‚àà Œ©_x$
    \item
      $Œ≥^0_x(s) = Œ≤(x)$
    \item
      $\bar Œ≥^1_x = g(x)$
    \item
      $Œ≥^t_x(s) = Œ≤(x)$ if $x$ is near $K$.
  \end{itemize}
\end{proposition}


Let us briefly sketch the geometric idea behind the above proposition
if we pretend there is only one point $x$, and drop it from the
notation, and also focus only on $Œ≥^1$.
By assumption, there is a finite collection of points $p_i$ in $Œ©$ and $Œª_i ‚àà
[0, 1]$ such that $g$ is the barycenter $\sum Œª_i p_i$. Since $Œ©$ is open and
connected, there is a smooth loop $Œ≥_0$ which goes through each $p_i$. The
claim is that $g$ is the average value of $Œ≥ = Œ≥_0 ‚àò h$ for some
self-diffeomorphism $h$ of $ùïä^1$. The idea is to choose $h$ such that
$Œ≥$ rushes to $p_1$, stays there during a time roughly $Œª_1$, rushes to
$p_2$, etc. But, in order to achieve average exactly $g$, it seems like $h$
needs to be a discontinuous piecewise constant map. The assumption that $g$ is
in the \emph{interior} of the convex hull gives enough slack to get away with
a smooth $h$.  Actually the
conclusion would be false without this interior assumption.

In the previous proof sketch, there is a lot of freedom in constructing $Œ≥$,
which is problematic when trying to do it consistently when $x$ varies.

\section{Preliminaries}
\label{sec:preliminaries}

In this section, $E$ is a real vector space with (finite) dimension $d$.
We'll need the Carath√©odory lemma:

\begin{lemma}[Carath√©odory's lemma]
\label{lem:caratheodory}
\lean{eq_center_mass_card_le_dim_succ_of_mem_convex_hull}
\leanok
  If a point $x$ of $E$ lies in the convex hull of a set $P$, then $x$
  can be written as the convex combination of at most $d + 1$ points in
  $P$.
\end{lemma}

\begin{proof}
  \leanok
  By assumption, there is a finite set of points $t_i$ in $P$ and
  weights $f_i$ such that $x = \sum f_i t_i$, each $f_i$ is non-negative
  and $\sum f_i = 1$.
  The goal it to reduce the number of these points until reaching at most
  $d+1$.
  It suffices to prove that one can get rid of one point as long as
  there are at least $d+2$ points.
  In this case there is some vanishing combination $\sum g_i t_i$ with
  $\sum g_i = 0$ and not all $g_i$ vanish.
  Let $S = \{i | g_i > 0\}$.
  Let $i_0$ in $S$ be an index minimizing $f_i/g_i$.
  We define new weights $k_i = f_i - g_i f_{i_0}/g_{i_0}$.
  Those weights sum to $\sum f_i - (\sum g_i)f_{i_0}/g_{i_0} = 1$
  and $k_{i_0} = 0$.
  Each $k_i$ is non-negative, thanks to the choice of $i_0$ if
  $i$ is in $S$ or using that $f_i$, $-g_i$ and $f_{i_0}/g_{i_0}$
  are all non-negative when $i$ is not in $S$.
  It remain to compute
  \begin{align*}
    \sum_{i ‚â† i_0} k_i t_i &= \sum_i k_i t_i \\
      &= \sum_i (f_i - g_i f_{i_0}/g_{i_0}) t_i  \\
      &= \sum_i f_i t_i - \left(\sum_i g_i t_i\right)f_{i_0}/g_{i_0})   \\
      &= x
  \end{align*}
  where we use $k_{i_0} = 0$ in the first equality.
\end{proof}

\begin{lemma}
\label{lem:refined_caratheodory}
  If a point $x$ of $E$ lies in the convex hull of a set $P$, then $x$
  can be written as the convex combination of at most $d + 1$ affinely
  independent points in $P$ with positive coefficients.
\end{lemma}

\begin{proof}
  \uses{lem:caratheodory}
  \cref{lem:caratheodory} gives points $p_i$ in $P$ and non-negative
  weights $w_i$ such that $x = \sum w_i p_i$ for $0 ‚â§ i ‚â§ k$ where
  $k ‚â§ d$. We first discard every point with vanishing weights.
  Now suppose the $p_i$'s are not affinely independent. Then there is
  some relation $p_{i_0} = \sum Œª_j p_j$ with positive weights
  $Œª_j$. We can then discard $p_{i_0}$ and replace each remaining
  $w_j$ by $w_j + w_{i_0}Œª _j$.
\end{proof}


\begin{definition}
  \label{def:surrounds_points}
  \lean{surrounding_pts}
  \leanok
  Let $F$ be a real vector space with dimension $d$. A point $x$ in $E$
  is surrounded by points $p_0$, \dots, $p_d$ if those points are
  affinely independent and there exist weights $w_i ‚àà (0, 1)$ such
  that $x = \sum_i w_i p_i$.
\end{definition}

Note that, in the above definition, the number of points $p_i$ is fixed
by the dimension $d$ of $F$.

\begin{lemma}
  \label{lem:int_cvx}
  \lean{eq_strict_center_mass_card_eq_dim_succ_of_mem_convex_hull_open}
  If a point $x$ of $E$ lies in the convex hull of an open set $P$,
  then it is surrounded by some collection of points belonging to $P$.
\end{lemma}

\begin{proof}
  \uses{lem:refined_caratheodory}
  \Cref{lem:refined_caratheodory} gives affinely independent points
  $p_0, \dots, p_k$ in $P$ such that $x$ is the convex combination of
  these points with positive weights $w_i$ (here $k \ge 0$).
  In particular, the family of vectors $p_i - p_0$, $1 ‚â§ i ‚â§ k$ is free.
  So we can complete it to a basis by appending vectors
  $f_{k+1}, \dots, f_d$.
  We set $p_i = p_0 + Œµf_i$ for $i \ge k+1$.
  This belongs to $P$ for $Œµ > 0$ small enough since $p_0$ is in $P$
  and $P$ is open.
  Note that the extend family of points is still affinely independent
  since the vectors $p_i - p_0$ are non-zero multiple of our basis
  elements.

  The next idea is to expand the simplex spanned by the $p_i$'s around its
  center of mass $b = 1/(d+1)\sum p_i$. So we set:
  \[
    p'_i = b + (1 + Œµ)(p_i - b).
  \]
  Those point are all in $P$ for $Œµ$ small enough because $P$ is open,
  and there are still affinely independent since they are the image of
  our original points by a homothety.
  Then we have:
  \[
    x = \sum_i w_i p_i = \sum_i \frac{w_i + Œµ/(d+1)}{1 + Œµ} p'_i
  \]
  where all coefficients are positive
\end{proof}


\begin{lemma}
  \label{lem:smooth_barycentric_coord}
  \uses{def:surrounds_points}
  For every $x$ in $E$ and every collection of points $p ‚àà E^{d+1}$
  surrounding $x$, there is a neighborhood $U$ of $\{(x, p)\}$
  and a function $w : E √ó E^{d+1} ‚Üí ‚Ñù^{d+1}$ such that, for every
  $(y, q)$ in $U$,
  \begin{itemize}
    \item
      $w$ is smooth at $(y, q)$
    \item
      $w(y, q) ‚àà (0, 1)$
    \item
      $y = \sum_{i=0}^d w_i(y, q)q_i$
  \end{itemize}
\end{lemma}

\begin{proof}
  If $d = 0$ then there is nothing to prove.
  Hence we will assume $d ‚â• 1$.
  Components of elements of $E^{d+1}$ or $‚Ñù^{d+1}$ will always be
  numbered from $0$ to $d$.
  By assumption, the family of points $p_i$ is affinely independent and
  there are weights $w_0, \dots, w_d$ such that $x = \sum_i w_i p_i$
  where each $w_i$ is in $(0, 1)$ and their sum is one.
  In particular

  \begin{align*}
    x - p_0 &= \sum_{i=0}^d w_i p_i - \sum_{i=0}^d w_i p_0 \\
            & = \sum_{i=0}^d w_i (p_i - p_0) \\
            & = \sum_{i=1}^d w_i (p_i - p_0).
  \end{align*}

  For $q$ in $E^{d+1}$ and $i ‚àà \{1, \dots, d\}$, we set
  $e_i(q) = q_i - q_0$.
  Since $p$ is a collection of $d+1$ affinely independent points,
  the family $e_i(p)$ is a basis of $e$.
  By continuity of the determinant, this stays true
  for $q$ in $Œ†_i B_Œ¥(p_i)$ for some positive $Œ¥$.
  Let $e^*_i(q)$ denote the elements of the dual basis.
  In order to prove continuity of these maps and define them
  for every $q$, we fix a basis $B$ of $E$ and the corresponding
  determinant $\det_B : E^d ‚Üí ‚Ñù$.
  We set $Œ¥(q) = \det_B(e(q))$ and define
  \[
    e^*_i(q) = v ‚Ü¶
    \det_B(e_1(q), \dots, e_{i-1}(q), v, e_{i+1}(q), \dots, e_d(q))/Œ¥(q).
  \]
  which should be interpreted as the zero linear form if $Œ¥(q) = 0$
  (this interpretation is automatic if division by zero in $‚Ñù$
  is defined as zero, as it should be).
  The map $q ‚Ü¶ e^*_i(q)$ is smooth on $Œ†_i B_Œ¥(p_i)$
  where $Œ¥$ does not vanish since the determinant is polynomial.
  We set $w_i(y, q) = e^*_i(q)(y - q_0)$.
  The computation of $x - p_0$ above proves that
  $w_i(x, p) = w_i$.
  We have $y - q_0 = \sum_{i = 1}^d w_i(y, q)(q_i - q_0)$.
  Hence
  \[
    y = \left(1 - \sum_{i = 1}^d w_i(y, q)\right)q_0 +
        \sum_{i = 1}^d w_i(y, q)q_i.
  \]
  We denote by $w_0(y, q)$ the coefficient in front of $q_0$ in the
  above formula.
  Hence we have $y = \sum_{i=0}^d w_i(y, q)q_i$ with
  $w_i(x, p) = w_i$ hence each $w_i(y, q)$ is in $(0, 1)$
  if $(y, q)$ is sufficiently close to $(x, p)$.
\end{proof}

\section{Constructing loops}

\subsection{Surrounding families}
\label{sub:surrounding_families}

It will be convenient to introduce some more vocabulary.

\begin{definition}
  \label{def:surrounds}
  \uses{def:surrounds_points}
  \lean{loop.surrounds}
  \leanok
  We say a loop $Œ≥$ surrounds a vector $v$ if $v$ is surrounded
  by a collection of points belonging to the image of $Œ≥$.
  Also, we fix a base point $0$ in $ùïä^1$ and say a loop is based at some
  point $b$ if $0$ is sent to $b$.
\end{definition}

The first main task in proving Proposition~\ref{prop:loops} is to construct
suitable families of loops $Œ≥_x$ surrounding $g(x)$, by assembling local
families of loops.
Those will then be reparametrized to get the correct average in the next
section.
In this section, we will work only with \emph{continuous} loops.
This will make constructions easier and we will smooth those loops
in the end, taking advantage of the fact that $Œ©$ and the surrounding
condition are open.

Thanks to Carath√©odory's lemma, constructing \emph{one} such loop
with values in some open $O$ is easy as soon as $v$ belongs to the
convex hull of $O$.

\begin{lemma}
  \label{lem:loop_of_hull}
  \uses{def:surrounds}
  \lean{surrounding_loop_of_convex_hull}
  \leanok
  If a vector $v$ is in the convex hull of a connected open subset $O$
  then, for every base point $b ‚àà O$, there is a continuous
  family of loops
  $Œ≥ \co [0, 1] √ó ùïä^1 ‚Üí E, (t, s) ‚Ü¶ Œ≥^t(s)$ such that, for all $t$ and
  $s$:
  \begin{itemize}
    \item
      $Œ≥^t$ is based at $b$
    \item
      $Œ≥^0(s) = b$
    \item
      $Œ≥^t(s) ‚àà O$
    \item
      $Œ≥^1$ surrounds $v$
  \end{itemize}
\end{lemma}

\begin{proof}
  \uses{lem:int_cvx}
  \leanok
  Since $O$ is open, \Cref{lem:int_cvx} gives points $p_i$ in $O$
  surrounding $x$.
  Since $O$ is open and connected, it is path connected.
  Let $Œª \co [0, 1] ‚Üí Œ©_x$ be a continuous path starting at $b$ and
  going through the points $p_i$.
  We can concatenate $Œª$ and its opposite to get $Œ≥^1$,
  say $Œ≥^1(s) = Œª((1-\cos 2œÄs)/2)$.
  This is a round-trip loop: it back-tracks when it reaches $Œª(1)$
  at $s = 1/2$.
  We then define $Œ≥^t$ as the round-trip that stops at $s = t/2$, stays
  still until $s = 1-t/2$ and then backtracks.
\end{proof}


\begin{definition}
  \label{def:family_surrounds}
  \uses{def:surrounds}
  \lean{surrounding_family}
  \leanok
  A continuous family of loops $Œ≥ \co E √ó [0, 1] √ó ùïä^1 ‚Üí F, (x, t, s) ‚Ü¶ Œ≥^t_x(s)$
  surrounds a map $g \co E ‚Üí F$ with base $Œ≤ \co E ‚Üí F$
  on $U ‚äÜ E$ if, for every $x$ in $U$, every $t ‚àà [0, 1]$ and every
  $s ‚àà ùïä^1$,
  \begin{itemize}
    \item
      $Œ≥^t_x$ is based at $Œ≤(x)$
    \item
      $Œ≥^0_x(s) = Œ≤(x)$
    \item
      $Œ≥^1_x$ surrounds $g(x)$.
  \end{itemize}
  The space of such families will be denoted by
  $\Loop(g, Œ≤, U)$.
\end{definition}

Families of surrounding loops are easy to construct locally.

\begin{lemma}
  \label{lem:local_loops}
  \uses{def:family_surrounds}
  \lean{local_loops}
  \leanok
  Assume $Œ©$ is open and connected over some neighborhood of $x_0$.
  If $g(x)$ is the convex hull of $Œ©_x$ for $x$ near $x_0$ then there is
  a continuous family of loops defined near $x_0$, based at $Œ≤$,
  taking value in $Œ©$ and surrounding $g$.
\end{lemma}

\begin{proof}
  \uses{lem:loop_of_hull, lem:smooth_barycentric_coord}
  In this proof we don't mention the $t$ parameter since it plays no
  role, but it is still there.
  \Cref{lem:loop_of_hull} gives a loop $Œ≥$ based at $Œ≤(x_0)$,
  taking values in $Œ©_{x_0}$ and surrounding $g(x_0)$.
  We set $Œ≥_x(s) = Œ≤(x) + (Œ≥(s) - Œ≤(x_0))$.
  Each $Œ≥_x$ takes values in $Œ©_x$ because $Œ©$ is open over some
  neighborhood of $x_0$.
  \Cref{lem:smooth_barycentric_coord} guarantees that this loop surrounds $g(x)$
  for $x$ close enough to $x_0$.
\end{proof}

The difficulty in constructing global families of surrounding loops is that
there are plenty of surrounding loops and we need to choose them
consistently.
The key feature of the above definition is that the $t$ parameter not only
allows us to cut out the corrugation
process in the next chapter, but also brings a ``satisfied or refund'' guarantee,
as explained in the next lemma.

\begin{lemma}
  \label{lem:satisfied_or_refund}
  \uses{def:family_surrounds}
  \lean{satisfied_or_refund}
  \leanok
  Each $\Loop(g, Œ≤, U)$ is path connected:
  for every $Œ≥_0$ and $Œ≥_1$ in $\Loop(g, Œ≤, U)$,
  there is a continuous map
  $Œ≥ \co [0, 1] √ó E √ó [0, 1] √ó ùïä^1 ‚Üí F, (œÑ, x, t, s) ‚Ü¶ Œ≥^t_{œÑ, x}(s)$
  which interpolates between $Œ≥_0$ and $Œ≥_1$ in
  $\Loop(g, Œ≤, U)$.
\end{lemma}

\begin{proof}
  Let $œÅ$ be the piecewise affine map from $‚Ñù$ to $‚Ñù$ such that
  $œÅ(œÑ) = 1$ if $œÑ ‚â§ 1/2$, $œÅ$ is affine on $[1/2, 1]$,
  $œÅ(œÑ) = 0$ if $œÑ ‚â• 1$.
  We set
  \[
    Œ≥_{œÑ, x}^t(s) =
    \begin{cases}
      Œ≥_{0, x}^{œÅ(œÑ)t}\left(\frac1{1 - œÑ} s\right) & \text{if $s < 1 - œÑ$ and $œÑ < 1$}\\
      Œ≤(x)                & \text{if $s = 1 - œÑ$}\\
      Œ≥_{1, x}^{œÅ(1-œÑ)t}\left(\frac1œÑ \big(s - (1- œÑ)\big)\right) & \text{if $s > 1 - œÑ$ and $œÑ > 0$}\\
    \end{cases}
  \]
  There is no surprise and no fun in checking that this is a
  well-defined continuous homotopy of families of loops based at $Œ≤$
  interpolating between $Œ≥_0$ and $Œ≥_1$.

  The beautiful observation motivating the above formula is why each
  $Œ≥^1_{œÑ, x}$ surrounds $g(x)$.
  The key is that the image of $Œ≥^1_{œÑ, x}$ contains the image of
  $Œ≥^1_{0, x}$ when $œÑ ‚â§ 1/2$, and contains  the image of
  $Œ≥^1_{1, x}$ when $œÑ ‚â• 1/2$.
  Hence $Œ≥^1_{œÑ, x}$ always surrounds $g(x)$.
\end{proof}

\begin{corollary}
  \label{cor:extend_loops}
  \uses{def:family_surrounds}
  \lean{extends_loops}
  \leanok
  Let $U_0$ and $U_1$ be open sets in $E$.
  Let $K_0 ‚äÜ U_0$ and $K_1 ‚äÜ U_1$ be compact subsets.
  For any $Œ≥_0 ‚àà \Loop(U_0, g, Œ≤)$ and $Œ≥_1 ‚àà \Loop(U_1, g, Œ≤)$,
  there exists $U ‚àà ùìù(K_0 ‚à™ K_1)$ and
  there exists $Œ≥ ‚àà \Loop(U, g, Œ≤)$
  which coincides with $Œ≥_0$ near $K_0$.
\end{corollary}

\begin{proof}
  \uses{lem:satisfied_or_refund}
  Let $U_0'$ be an open neighborhood of $K_0$ whose closure
  $\bar U_0'$ is compact in $U_0$.
  Since $\bar U_0'$ and $K_1' := K_1 ‚àñ (K_1 ‚à© U_0)$
  are disjoint compact subsets of $E$, there is some continuous cut-off
  $œÅ \co E ‚Üí [0, 1]$ which vanishes on $U_0'$ and equals one on some
  neighborhood $U_1'$ of $K_1'$.

  Lemma~\ref{lem:satisfied_or_refund} gives a homotopy of loops
  $Œ≥_œÑ$ from $Œ≥_0$ to $Œ≥_1$ on $U_0 ‚à© U_1$.
  On $U_0' ‚à™ (U_0 ‚à© U_1) ‚à™ U_1'$, which is a
  neighborhood of $K_0 ‚à™ K_1$, we set
  \[
      Œ≥_x =
      \begin{cases}
        Œ≥_{0, x}       & \text{for $x ‚àà U_0'$} \\
        Œ≥_{œÅ(x), x} & \text{for $x ‚àà U_0 ‚à© U_1$} \\
        Œ≥_{1, x}       & \text{for $x ‚àà U_1'$}
      \end{cases}
  \]
  which has the required properties.
\end{proof}


\begin{lemma}
  \label{lem:‚àÉ_surrounding_loops}
  \uses{def:family_surrounds}
  \lean{exists_surrounding_loops}
  \leanok
  In the setup of Proposition~\ref{prop:loops}, assume we have a
  continuous family $Œ≥$ of loops defined near $K$ which is based at $Œ≤$,
  surrounds $g$ and such that each $Œ≥_x^t$ takes values in $Œ©_x$.
  Then there such a family which is defined on all of $U$ and agrees
  with $Œ≥$ near $K$.
\end{lemma}

\begin{proof}
  \uses{lem:loop_of_hull, lem:local_loops, cor:extend_loops}
  Let $U_0$ be an open set containing $K$ and
  contained in the domain of $Œ≥$. Let $U_0'$ be an open neighborhood of $K$
  with compact closure in $U_0$. Let $U_i$, $i ‚â• 1$ be a local finite covering of
  $U ‚àñ U_0'$ by open subsets not intersecting $K$ and where the preceding
  observations gives families of loops $Œ≥^i$. We also set $Œ≥^0 = \rst{Œ≥}{U_0}$.
  In particular the open sets $U_i$, $i ‚â• 0$ cover the whole of $U$, and only
  $U_0$ intersects $K$. Let $K_i$, $0 ‚â§ i ‚â§ N$, be a family of compact sets with
  $K_i ‚äÇ U_i$ which covers $U$. We repeatedly apply
  Corollary~\ref{cor:extend_loops} to $K_i$ and $K_{i+1}$, in this order, to
  get a family $Œ≥'$ defined over all $U$. Since each step preserves the
  family on $\Op{K_i}$ and only $U_0$ intersects (in fact contains) $K$, we do
  have $Œ≥' = Œ≥$ on $\Op{K}$.
\end{proof}

\subsection{The reparametrization lemma}
\label{sub:the_reparametrization_lemma}

The second ingredient needed to prove Proposition~\ref{prop:loops} is a
parametric reparametrization lemma.

\begin{lemma}
\label{lem:reparametrization}
\uses{def:surrounds}
\lean{reparametrization}
\leanok
Let $Œ≥ \co E √ó ùïä^1 ‚Üí F$ be a smooth family of loops surrounding
a map $g$ with base $Œ≤$ over some $U ‚äÜ E$.
There is a family of circle diffeomorphisms $œÜ : U √ó ùïä^1 ‚Üí ùïä^1$ such
that each $Œ≥_x ‚àò œÜ_x$ has average $g(x)$ and $œÜ_x(0) = 0$.
\end{lemma}

\begin{proof}
  \uses{lem:caratheodory, lem:smooth_barycentric_coord}
  For any fixed $x$, since $Œ≥_x$ strictly surrounds $g(x)$, there are points
  $s_1, ‚Ä¶, s_{n+1}$ in $ùïä^1$ such that $g(x)$ is surrounded
  by the corresponding points $Œ≥_x(s_j)$.

  Let $Œº_1, ‚Ä¶, Œº_{n+1}$ be smooth positive probability measures very
  close to the Dirac measures on $s_j$ (ie. $Œº_j = f_j\, ds$ for some
  smooth positive function $f_j$ and, for any function $h$,
  $\int h\,dŒº_j$ is almost $h(s_j)$).  We set $p_j = \int Œ≥_x\, d\mu_j$, which
  is almost $Œ≥_x(s_j)$ so that $g(x) = \sum w_j p_j$ for some weights
  $w_j$ in the open interval $(0, 1)$ according to
  \Cref{lem:smooth_barycentric_coord}.

  If $x'$ is in a sufficiently small neighborhood of $x$,
  \Cref{lem:smooth_barycentric_coord} gives smooth weight functions $w_j$
  such that $g(x') = \sum w_j(x')p_j(x')$.
  Let $U^i$, $i ‚â• 1$ be a locally finite cover of $U$ by such
  neighborhoods, with corresponding measures $Œº_j^i$, moving points
  $p_j^i$ and weight functions $w_j^i$.
  Let $(œÅ_i)$ be a partition of unity associated to this covering. For
  every $x$, we set
  \[
    Œº_x = \sum_{i=1}^‚àû \sum_{j=1}^{n+1} œÅ_i(x)w_j^i(x)\, Œº_j^i
  \]
  so that:
  \begin{align*}
    \int Œ≥_x\, dŒº_x &=
    \sum_i œÅ_i(x)\sum_{j=1}^{n+1} w_j^i(x) \int Œ≥_x\, dŒº_j^i\\
    &= \sum_i œÅ_i(x)\sum_{j=1}^{n+1} w_j^i(x) p_j^i(x)\\
    &= \sum_i œÅ_i(x) g(x) = g(x).
  \end{align*}
  We now set $œÜ_x^{-1}(t) = \int_0^tdŒº_x$ so that
  $g(x) = \overline{Œ≥_x ‚àò œÜ_x}$ for all $x$.
\end{proof}

\subsection{Proof of the loop construction proposition}
\label{sub:proof_of_the_loop_construction_proposition}

We finally assemble the ingredients from the previous two sections.

\begin{proof}[Proof of Proposition~\ref{prop:loops}]
  \proves{prop:loops}
  \uses{lem:‚àÉ_surrounding_loops, lem:reparametrization}
  Let $Œ≥^*$ be a family of loops surrounding the origin in $F$,
  constructed using \Cref{lem:local_loops}.
  For $x$ in some neighborhood $U^*$ of $K$ where $g = Œ≤$, we set
  $Œ≥_x = g(x) + ŒµŒ≥^*$ where $Œµ > 0$ is sufficiently small to ensure
  the image of $Œ≥_x$ and its convex hull are contained in $Œ©_x$ (recall $Œ©$ is
  open and $K$ is compact).
  Lemma~\ref{lem:‚àÉ_surrounding_loops} extends this family to a continuous
  family of surrounding loops $Œ≥_x$ for all $x$ (this is not yet our
  final $Œ≥$).

  We then need to approximate this continuous family by a smooth one.
  Some care is needed to ensure that it stays based at $Œ≤$.
  For instance, we can first compose each loop by some fixed surjective
  continuous map from $ùïä^1$ to itself that sends a neighborhood of $0$
  to $0$.
  This way each loop becomes constant near $0$, and a convolution
  smoothing will then keep the value at $0$.
  If the smoothing is sufficiently $C^0$ small then the new $Œ≥$ is
  still surrounding and takes values in $Œ©$.

  Then Lemma~\ref{lem:reparametrization} gives a family of circle
  diffeomorphisms $h_x$ such that $Œ≥^1_x ‚àò h_x$ has average $g(x)$.

  Finally we choose a cut-off function function $œá$ which vanishes on
  $\Op{K}$ and equals one on $\Op{U ‚àñ U^*}$.  In $U^*$, we replace
  $Œ≥_x ‚àò h_x = g(x) + Œ≥^* ‚àò h_x$ by $g(x) + œá(x)Œ≥^* ‚àò h_x$. This
  operation does not change the average values of these loops, because
  it rescales them around their average value, but makes them constant
  on $\Op{K}$. Also, those loops stay in $Œ©$, thanks to our choice of $Œµ$.
\end{proof}

% vim: set expandtab sw=2 tabstop=2:
