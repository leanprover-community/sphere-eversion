\chapter{Global theory of open and ample relations}
\label{chap:global}

\section{Preliminaries}

\subsection{Vector bundles operations}
\label{sec:vector_bundles_operations}

\begin{definition}
\label{def:pull_back_bundle}
For every bundle $p : E â†’ B$ and every map $f \co B' â†’ B$,
the pull-back bundle $f^*E â†’ B'$ is defined by
$f^*E = \{(b', e) âˆˆ B' Ã— E \;|\; p(e) = f(b')\}$ with
the obvious projection to $B'$.
\end{definition}

The case of vector bundles.

\begin{definition}
\label{def:hom_bundle}
Let $E â†’ B$ and $F â†’ B$ be two vector bundles over some smooth manifold
$B$. The bundle $\Hom(E, F) â†’ B$ is the set of linear maps from
$E_b$ to $F_b$ for some $b$ in $B$, with the obvious projection map.
\end{definition}

Set-theoretically, one can define $\Hom(E, F)$ as the set of subsets
$S$ of $E Ã— F$ such that there exists $b$ such that $S âŠ‚ E_b Ã— F_b$
and $S$ is the graph of a linear map. But the type theory formalization
will use other tricks here. The facts that really matter are listed in
\cref{lem:one_jet_extension_prop}.


\subsection{Jets spaces}

\begin{definition}
\label{def:one_jet_space}
\uses{def:pull_back_bundle, def:hom_bundle}
Let $M$ and $N$ be smooth manifolds. Denote by
$p_1$ and $p_2$ the projections of $M Ã— N$ to
$M$ and $N$ respectively.

The space $J^1(M, N)$ of $1$-jets of maps from $M$ to $N$ is
$Hom(p_1^*TM, p_2^*TN)$
\end{definition}

We will use notations like $(m, n, Ï†)$ to denote an element
of $J^1(M, N)$,
but one should keep in mind that $J^1(M, N)$ is not a product,
since $Ï†$ lives in $\Hom(T_mM, T_nN)$ which depends on $m$ and $n$.


\begin{definition}
\label{def:one_jet_extension}
\uses{def:one_jet_space}
The $1$-jet of a smooth map $f \co M â†’ N$ is the map from
$m$ to $J^1(M, N)$ defined by $j^1f(m) = (m, f(m), T_mf)$.
\end{definition}

The composition of a section $\F \co M â†’ J^1(M, N)$ with the projection
onto $N$ will sometimes be denoted by $\bs \F \co M â†’ N$ and called the
base map of $\F$. For any $m$, $\F(m)_Ï†$ will denote the component of $\F(m)$
living in $\Hom(T_mM, T_{\bs\F(m)}N)$.

\begin{lemma}
\label{lem:one_jet_extension_prop}
\uses{def:one_jet_extension}
For every smooth map $f \co M â†’ N$,
\begin{enumerate}
  \item
    \label{lem:one_jet_smooth}\uses{def:one_jet_space, def:one_jet_extension}
    $j^1f$ is smooth
  \item
    \label{lem:one_jet_section}\uses{def:one_jet_space, def:one_jet_extension}
    $j^1f$ is a section of $J^1(M, N) â†’ M$
  \item
    \label{lem:one_jet_zero_jet}\uses{def:one_jet_space, def:one_jet_extension}
    $j^1f$ composed with $J^1(M, N) â†’ N$ is $f$.
\end{enumerate}
\end{lemma}

\begin{proof}
  This is obvious by construction\dots
\end{proof}

\begin{definition}
\label{def:holonomic_section}
\uses{def:one_jet_space, lem:one_jet_extension_prop}
A section $\F$ of $J^1(M, N) â†’ M$ is called holonomic if it is the
$1$--jet of its base map.
Equivalently, $\F$ is holonomic if there exists
$f \co M â†’ N$ such that $\F = j^1f$, since such a map is
necessarily $\bs \F$.
\end{definition}

\section{First order differential relations}

\begin{definition}
  \label{def:rel}
  \uses{def:one_jet_space}
  A first order differential relation for maps from $M$ to $N$ is a
  subset $\Rel$ of $J^1(M, N)$.
\end{definition}

\begin{definition}
  \label{def:formal_sol}
  \uses{def:rel, def:one_jet_extension}
  A formal solution of a differential relation $\Rel âŠ‚ J^1(M, N)$ is a
  section of $J^1(M, N) â†’ M$ taking values in $\Rel$.
  A solution of $\Rel$ is a map from $M$ to $N$ whose $1$--jet extension
  is a formal solution.
\end{definition}


\begin{definition}
  \label{def:htpy_formal_sol}
  \uses{def:formal_sol}
  A homotopy of formal solutions of $\Rel$ is a family of sections
  $\F : â„ Ã— M â†’ J^1(M, N)$ which is smooth over $[0, 1] Ã— M$
  and such that each $m â†¦ \F(t, m)$ is a formal solution
  when $t$ is in $[0, 1]$.
\end{definition}

The next definition will be used in cases where $X$ and $Y$ are vector spaces,
in order to relate the global theory to the local one.

\begin{definition}
  \label{def:transfer_map}
  Given manifolds $M$, $X$, $N$ and $Y$ and smooth embeddings $g : Y â†’ N$
  and $h : X â†’ M$ we get a transfer map $Ïˆ_{g, h} : J^1(X, Y) â†’ J^1(M, N)$
  defined by
  \[
    Ïˆ_{g, h}(x, y, Ï†) = (h(x), g(y), T_yg âˆ˜ Ï† âˆ˜ (T_xh)â»Â¹)
  \]
  and an operator on sections which sends $\F : M â†’ J^1(M, N)$ to
  $Î¨_{g, h}\F : X â†’ J^1(X, Y)$ defined when $\bs\F(h(X)) âŠ‚ g(Y)$ by
  \[
    Î¨_{g, h}\F(x) = (x, gâ»Â¹ âˆ˜ \bs\F âˆ˜ h(x), (T_{gâ»Â¹ âˆ˜ \bs\F âˆ˜ h(x)}g)â»Â¹ âˆ˜ \F(h(x))_Ï† âˆ˜ T_xh).
  \]
  Given a relation $\Rel âŠ‚ J^1(M, N)$, the induced relation in $J^1(X, Y)$
  is $Ïˆ_{g, h}â»Â¹\Rel$.
\end{definition}

The following is a localization lemma needed to take advantage of all the work
from the previous chapter.

\begin{lemma}
  \label{lem:transfer}\uses{def:transfer_map}
  In the situation of the previous definition, given a section $\F : M â†’ J^1(M, N)$:
  \begin{itemize}
    \item $Î¨_{g, h}(\F)$ is a smooth section of $J^1(X, Y)$.
    \item $\F$ is holonomic on $s âŠ‚ h(X) âˆ© \bs\Fâ»Â¹(g(Y))$ if and only if $Î¨_{g, h}(\F)$
      is holonomic on $hâ»Â¹(s)$.
    \item $\F$ is a formal solution of $\Rel$ on $h(X) âˆ© \bs\Fâ»Â¹(g(Y)$ if and only if $Î¨_{g, h}(\F)$
      is a formal solution of the induced relation $Î¨_{g, h}â»Â¹\Rel$.
  \end{itemize}
\end{lemma}

\begin{proof}
  The first point is clear by composition. In order to prove the second point
  while keeping notations under control, we set
  $f(x) = gâ»Â¹ âˆ˜ \bs\F âˆ˜ h$. Using this notation
  $Î¨_{g, h}\F(x) = (x, f(x), (T_{f(x)}g)â»Â¹ âˆ˜ \F(h(x))_Ï† âˆ˜ T_xh)$. We have
  \begin{align*}
    T_x f &= T_{\bs\F âˆ˜ h(x)}(gâ»Â¹) âˆ˜ T_{h(x)}\bs\F âˆ˜ T_x h\\
                         &= T_{\bs\F âˆ˜ h(x)}(gâ»Â¹) âˆ˜ T_{h(x)}\bs\F âˆ˜ T_x h\\
                         &= \left(T_{f(x)}g\right)â»Â¹ âˆ˜ T_{h(x)}\bs\F âˆ˜ T_x h
  \end{align*}
  hence $Î¨_{g, h}\F$ is holonomic at $x$ if and only if
  $\left(T_{f(x)}g\right)â»Â¹ âˆ˜ \F(h(x))_Ï† âˆ˜ T_xh = \left(T_{f(x)}g\right)â»Â¹ âˆ˜ T_{h(x)}\bs\F âˆ˜ T_x h$
  and this is equivalent to $\F(h(x))_Ï† = T_{h(x)}\bs\F$ which is the holonomy condition for
  $\F$ at $h(x)$.

  The third point is a direct consequence of the easy formula $Ïˆ_{g, h} âˆ˜ Î¨_{g, h}(\F) = F âˆ˜ h$.
\end{proof}

\begin{definition}
  \label{def:h-princ}
  \uses{def:formal_sol, def:htpy_formal_sol}
  A first order differential relation $\Rel âŠ‚ J^1(M, N)$ satisfies the
  $h$-principle if every formal solution of $\Rel$ is homotopic to a
  holonomic one.
  It satisfies the parametric $h$-principle if, for every manifold with
  boundary $P$, every family $\F : P Ã— M â†’ J^1(M, N)$ of formal
  solutions which are holonomic for $p$ in $ğ“(âˆ‚P)$
  is homotopic to a family of holonomic ones relative to $ğ“(âˆ‚P)$.
\end{definition}

\begin{lemma}
  \label{lem:sol_chart}
  \uses{def:h-princ}
  The above definitions translate to the definitions of the previous
  chapter in local charts. (We'll need more precise statements...)
\end{lemma}


\subsection*{Parametricity for free}

In many cases, relative parametric $h$-principles can be deduced from relative
non-parametric ones with a larger source manifold.
Let $X$, $P$ and $Y$ be manifolds, with $P$ seen a parameter space.
Denote by $Î¨$ the map from $J^1(X Ã— P, Y)$ to $J^1(X, Y)$ sending $(x, p, y, Ïˆ)$ to
$(x, y, Ïˆ âˆ˜ Î¹_{x, p})$ where $Î¹_{x, p} : T_xX â†’ T_xX Ã— T_pP$ sends $v$ to $(v, 0)$.

To any family of sections $F_p : x â†¦ (f_p(x), Ï†_{p, x})$ of $J^1(X, Y)$, we
associate the section $\bar F$ of $J^1(X Ã— P, Y)$ sending $(x, p)$ to
$\bar F(x, p) := (f_p(x), Ï†_{p, x} âŠ• âˆ‚f/âˆ‚p(x, p))$.

\begin{lemma}
  \label{lem:param_trick}
  \uses{def:holonomic_section, def:formal_sol}
  In the above setup, we have:
  \begin{itemize}
    \item
      $\bar F$ is holonomic at $(x, p)$ if and only if $F_p$ is holonomic
      at $x$.
    \item
      $F$ is a family of formal solutions of some $\Rel âŠ‚ J^1(X, Y)$ if and
      only if $\bar F$ is a formal solution of $\Rel^P := Î¨^{-1}(\Rel)$.
  \end{itemize}
\end{lemma}

\begin{proof}
  TODO\dots
\end{proof}

\begin{lemma}
  \label{lem:param_for_free}
  \uses{def:h-princ}
  Let $\Rel$ be a first order differential relation for maps from $M$ to
  $N$.
  If, for every manifold with boundary $P$, $\Rel^P$ satisfies the
  $h$-principle then $\Rel$ satisfies the parametric $h$-principle.
  Likewise, the $C^0$-dense and relative $h$-principle for all
  $\Rel^P$ imply the parametric $C^0$-dense and relative $h$-principle for
  $\Rel$.
\end{lemma}

\begin{proof}
  \uses{lem:param_trick}
  This obviously follows from \cref{lem:param_trick}.
\end{proof}


\section{The $h$-principle for open and ample differential relations}
\label{sec:general_theory}

In this chapter, $X$ and $Y$ are smooth manifolds and $\Rel$ is a first order
differential relation on maps from $X$ to $Y$: $\Rel âŠ‚ J^1(X, Y)$.
For any $Ïƒ = (x, y, Ï†)$ in $\Rel$ and any dual pair
$(Î», v) âˆˆ T^*_xX Ã— T_xX$,
we set:
\[
    \Rel_{Ïƒ, Î», v} =
     \Conn_{Ï†(v)}\left\{w âˆˆ T_yY \;;\;
       \big(x,\; y,\; Ï† + (w - Ï†(v))âŠ—Î»\big) âˆˆ \Rel\right\}
\]
where $\Conn_a A$ is the connected component of $A$ containing $a$. In order to
decipher this definition, it suffices to notice that $Ï† + (w - Ï†(v))âŠ—Î»$ is the
unique linear map from $T_xX$ to $T_yY$ which coincides with $Ï†$ on $\ker Î»$
and sends $v$ to $w$. In particular, $w = Ï†(v)$ gives back $Ï†$.

Of course we will want to deal with more that one point, so we will consider a
vector field $V$ and a $1$--form $Î»$ such that $Î»(V) = 1$ on some subset $U$ of
$X$, a formal solution $F$ (defined at least on $U$), and get the corresponding
$\Rel_{F, Î», v}$ over $U$.

One easily checks that $\Rel_{Ïƒ, Îº^{-1}Î», Îºv} = Îº\Rel_{Ïƒ, Î», v}$ hence the above
definition only depends on $\ker Î»$ and the direction $â„V$.

\begin{definition}
  \label{def:ample_relation}
  \uses{def:ample_subset}
  A relation $\Rel$ is ample if, for every $Ïƒ = (x, y, Ï†)$ in $\Rel$ and every
  $(Î», v)$, the slice $\Rel_{Ïƒ, Î», v}$ is ample in $T_yY$.
\end{definition}

\begin{lemma}
  \label{lem:ample_iff_loc}
  \uses{def:ample_relation, def:ample_relation_loc, def:transfer_map}
  Given manifolds $W$, $X$, $Y$ and $Z$ and smooth embeddings $g : Z â†’ Y$
  and $h : W â†’ X$, the relation induced (in the sense of \Cref{def:transfer_map})
  in $J^1(W, Z)$ by a ample relation in $J^1(X, Y)$ is ample.
\end{lemma}

\begin{proof}
  By definition, the relation induced by $\Rel$ is
  $Ïˆ_{g, h}â»Â¹\Rel$ where
  $Ïˆ_{g, h}(w, z, Ï†) = (h(w), g(z), T_zg âˆ˜ Ï† âˆ˜ (T_wh)â»Â¹)$.
  Fix $Ïƒ =(w, z, Ï†) âˆˆ Ïˆ_{g, h}â»Â¹\Rel$
  and a dual pair $(Î», v)$ on $T_wW$. We set $G = T_z g$ and $H = T_w h$. Both
  those maps are linear isomorphisms. We compute the slice corresponding to $(Ïƒ, Î», v)$:
  \begin{align*}
    Ïˆ_{g, h}â»Â¹\Rel(Ïƒ, Î», v)
    &= \left\{u âˆˆ T_wW \;\left|\; (w, z, Ï† + (u - Ï†v)âŠ—Î») âˆˆ Ïˆ_{g, h}â»Â¹\Rel \right.\right\}\\
    &= \left\{u âˆˆ T_wW \;\left|\; (h(w), g(z), G âˆ˜(Ï† + (u - Ï†v)âŠ—Î»)âˆ˜ Hâ»Â¹) âˆˆ \Rel \right.\right\}\\
%    &= \left\{u âˆˆ T_wW \;\left|\; (h(w), g(z), G âˆ˜ Ï† âˆ˜ Hâ»Â¹ + (Gu - G âˆ˜ Ï† âˆ˜ Hâ»Â¹ âˆ˜ Hv)âŠ—(Î» âˆ˜ Hâ»Â¹)) âˆˆ \Rel \right.\right\}\\
%    &= \left\{u âˆˆ T_wW \;\left|\; (h(w), g(z), G âˆ˜ Ï† âˆ˜ Hâ»Â¹ + (Gu - G âˆ˜ Ï† âˆ˜ Hâ»Â¹ âˆ˜ Hv)âŠ—(Î» âˆ˜ Hâ»Â¹)) âˆˆ \Rel \right.\right\}\\
%    &= \left\{u âˆˆ T_wW \;\left|\; Gu âˆˆ \Rel((h(w), g(z), G âˆ˜ Ï† âˆ˜ Hâ»Â¹), Î» âˆ˜ Hâ»Â¹, Gu) \right.\right\}\\
    &= Gâ»Â¹\Rel((h(w), g(z), G âˆ˜ Ï† âˆ˜ Hâ»Â¹), Î» âˆ˜ Hâ»Â¹, Gu).
  \end{align*}
  Hence the slice $Ïˆ_{g, h}â»Â¹\Rel(Ïƒ, Î», v)$ is the image of a slice of $\Rel$
  under a linear isomorphism, hence ample.
\end{proof}

\begin{lemma}
  \label{lem:open_ample_immersion}
  The relation of immersions of $M$ into $N$ in positive codimension is open
  and ample.
\end{lemma}

\begin{proof}
  \proves{lem:open_ample_immersion}
  \uses{lem:open_ample_immersion_loc}
  This obviously follows from \cref{lem:open_ample_immersion_loc}. Better, we should remove
  \cref{lem:open_ample_immersion_loc} and copy-paste its proof here.
\end{proof}

\begin{theorem}[Gromov]
  \label{thm:open_ample}
  \uses{def:h-princ}
  If $\Rel$ is open and ample then it satisfies the relative and parametric
  $C^0$-dense $h$-principle.
\end{theorem}

We first explain how to get rid of parameters, using the
relation $\Rel^P$ for families of solutions parametrized by $P$.

\begin{lemma}
    \label{lem:ample_parameter}
    \uses{def:ample_relation}
    If $\Rel$ is ample then, for any parameter space $P$, $\Rel^P$ is also ample.
\end{lemma}

\begin{proof}
  We fix $Ïƒ = (x, y, Ïˆ)$ in $\Rel^P$.
  For any $Î» = (Î»_X, Î»_P) âˆˆ T^*_xX Ã— T^*_pP$ and $v = (v_X, v_P) âˆˆ T_xX Ã— T_pP$
  such that $Î»(v) = 1$, we need to prove that $\Conv\Rel^P_{Ïƒ, Î», v} = T_yY$.
  Unfolding the definitions gives:
  \[
  \Rel^P_{Ïƒ, Î», v} = \Conn_{Ï†(v)}\left\{w âˆˆ T_yY \;;\;
      \big(x,\; y,\; Ïˆ âˆ˜ Î¹_{x, p} + (w - Ïˆ(v))âŠ—Î»_X\big) âˆˆ \Rel\right\}.
  \]
  A degenerate but easy case is when $Î»_X = 0$. Then the condition on $w$
  becomes $Ïˆ âˆ˜ Î¹_{x, p} âˆˆ \Rel$, which is true by definition of $\Rel^P$, so
  $\Rel^P_{Ïƒ, Î», v} = T_yY$.

  We now assume $Î»_X$ is not zero and choose $u âˆˆ T_xX$ such that $Î»_X(u) = 1$.
  We then have $\Rel^P_{Ïƒ, Î», v} = \Rel_{Î¨Ïƒ, Î»_X, u} + Ïˆ(v) - Ïˆâˆ˜Î¹_{x, p}(u)$.
  Because $\Rel$ is ample and taking convex hull commutes with translation, we
  get that $\Conv\Rel^P_{Ïƒ, Î», v} = T_yY$.
\end{proof}

\begin{proof}[Proof of Theorem~\ref{thm:open_ample}]
  \proves{thm:open_ample}
  \uses{lem:param_for_free, lem:ample_parameter, lem:sol_chart,
  lem:ample_iff_loc, lem:h_principle_open_ample_loc}
  Lemmas~\ref{lem:param_for_free} and~\ref{lem:ample_parameter} prove we can
  assume there are no parameters. So we start with a single formal solution $F$
  of $\Rel$, which is holonomic near some closed subset $A âŠ‚ X$.

  We first assume $X$ is closed, and will then explain the proof
  adjustments needed in the non-compact case.
  By compactness, there are finite many compact subsets
  $(K_i)_{1 â‰¤ i â‰¤ N}$ contained in coordinate charts $U_i$ and such that
  $\bigcup K_i = X$.

  We prove by induction on $i$ from $0$ to $N$ that there are formal solutions
  $F_i$, starting with $F_0 = F$, that are homotopic to $F$ relative to $A$,
  holonomic on $K_{â‰¤ i} := \bigcup_{j â‰¤ i} K_j$ and whose base maps are
  $(1-2^{-i})Îµ$-close to that of $F$ (this contrived bound will be convenient
  for the non-compact case).

  Assume $F_i$ has been constructed for some $i < N$.
  We now want to construct it on $U_{i+1}$.
  \Cref{lem:ample_iff_loc} ensures the pull-back of $\Rel$ in the chart
  corresponding to $U_{i+1}$ is ample in the sense of the preceding
  chapter.
  Hence \Cref{lem:h_principle_open_ample_loc} can be applied to
  construct $F_{i+1}$, using the image of $K_{i+1}$ as $K_0$ and
  the image of $A âˆ© K_{i+1} âˆ© K_{â‰¤ i}$ as $C$.
  It is holonomic on $K_{â‰¤ i+1}$ because it agrees with $F_i$ near
  $K_{â‰¤ i}$ and is holonomic near $K_{i+1}$.

  Once all $F_i$ are constructed, we define $F^t$ to be the concatenation of all
  homotopies relating $F_i$ to $F_{i+1}$.

  If $X$ is not compact, then one can use a countable family of subsets
  $(U_i, K_i)$ which is locally finite (ie. every point $x$ has a neighborhood
  intersecting only finitely many $U_i$). The way we have chosen $C^0$-bounds
  ensures that each $\bs F_i$ is still at distance at most $Îµ$ from $\bs F$. We
  now have countably many homotopies to concatenate, so we need to reparametrize
  the $i$-th homotopy by an interval of length $2^{-i}$. This give a family of
  sections of $J^1(X, Y)$ parametrized by $t âˆˆ [0, 1)$. But our local finiteness
  assumption implies that, for each each $x$, there is some $t_0 < 1$ and some
  neighborhood $U$ of $x$ such that our family is $t$--independent on $U$ for
  $t â‰¥ t_0$. So we can extend to $t = 1$.  The resulting family is smooth since
  smoothness is a local condition in both $x$ and $t$.
\end{proof}

\begin{theorem}[Smale 1958]
  \label{thm:sphere_eversion}
	There is a homotopy of immersions of $ğ•Š^2$ into $â„^3$ from the inclusion map to
	the antipodal map $a : q â†¦ -q$.
\end{theorem}

\begin{proof}
  \uses{thm:open_ample, lem:open_ample_immersion}
	We denote by $Î¹$ the inclusion of $ğ•Š^2$ into $â„^3$.
	We set $j_t = (1-t)Î¹	+ ta$.
  This is a homotopy from $Î¹$ to $a$ (but not animmersion for $t=1/2$).
  Using the canonical trivialization of the tangent
	bundle of $â„^3$, we can set, for $(q, v) âˆˆ Tğ•Š^2$,
	$G_t(q, v) = \mathrm{Rot}_{Oq}^{Ï€t}(v)$, the rotation around axis $Oq$ with
	angle $Ï€t$.
  The family $Ïƒ : t â†¦ (j_t, G_t)$ is a homotopy of formal immersions
  relating $j^1Î¹$ to $j^1a$.
  It is homotopic by reparametrization to a homotopy of formal immersions
  relating $j^1Î¹$ to $j^1a$ which are holonomic for $t$ near the
  $0$ and $1$.

  The above theorem ensures this family is homotopic,
	relative to $t = 0$ and $t = 1$, to a family of holonomic formal immersions,
	ie a family $t â†¦ j^1f_t$ with $f_0 = Î¹$, $f_1 = a$, and each $f_t$ is an
	immersion.
\end{proof}

% vim: set expandtab sw=2 tabstop=2:
